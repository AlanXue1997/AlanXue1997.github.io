<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>藏于图片的信息</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@XueZhonghao" /><meta name="twitter:title" content="藏于图片的信息" /><meta name="twitter:description" content="背景"><meta name="description" content="背景"><meta name="google-site-verification" content="epFgX0s_0RM3CdjwFcsewfXzPov2g8s9ZBOLyaIUH-o"><link rel="shortcut icon" href="/assets/totora.png"> <!--<link rel="icon" href="/assets/totora.png">--><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="stylesheet" href="/assets/prism.css"><link rel="canonical" href="/notes/Image-Encrypting"><link rel="alternate" type="application/atom+xml" title="AlanXue's blog" href="/feed.xml" /> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','https://www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-79196511-1', 'auto'); ga('send', 'pageview'); </script></head><body><aside class="logo"> <a href="/"> <img src="/assets/Totora2.png"> </a> <span class="logo-prompt">Back to Home</span></aside><!--src="http://www.gravatar.com/avatar/742cf6353760888dd24b7f22843cca55.png?s=80" class="gravatar" --><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>藏于图片的信息</h1><time>June 10, 2016</time></div><div class="divider"></div><h2 id="section">背景</h2><p>上学期刚开学的时候，在软件工程导论课（网课，在<a href="http://www.icourse163.org/">中国大学MOOC</a>上）上，<a href="http://www.cs.hit.edu.cn/?q=node/62">战德臣</a>老师曾经讲过一个信息隐藏问题，可以利用人眼对颜色的微小变化不敏感这一特点，将信息隐藏在图片之中，从而掩人耳目。但我曾经尝试过用Ｃ、Pascal去处理图片，但那个难度是有的，不可能简单百度一下就去应用，所以就没有去尝试。</p><p>这几天正在学着使用MATLAB，发现它处理起图像是如此的轻松加愉快，于是就想拿战老师讲的这个信息隐藏的方法试试。</p><div class="divider"></div><h2 id="section-1">方法</h2><p>图片在MATLAB中存储为一个三维矩阵[height, width, 3(<a href="http://baike.baidu.com/link?url=iLhWJJu4SxxWPlKqg86uLqa9Gjs9_LgxJAje4CofevlOcTsC7LSNMmtnOn3GoWhvQyfWr9rFLYfEb2MiBaRxb_">RGB</a>)]，数据类型是8位无符号整形（uint8），也就是0~255之间。</p><p>将信息存储在每个数的最后一位（二进制位），只有这样，颜色的变化才是人眼看不出来的。也就是说，在存储的时候，每个数相当于1位。因为每个像素都有R、G、B三个值，所以每个像素可以存储3位。</p><p>每一个字符占16位（若只有ASCII码，8位），为了方便写代码，用三的整数倍，18位（9位）表示一个字符，也就是说，每6个（3个）像素，表示一个字符。</p><p>具体方法如下（图片都是放大后的）：</p><p>例：要将字符’例’存入某图片的前6个像素</p><p><img src="/assets/pix1.png" /></p><p>在MATLAB中存储为</p><blockquote> <center> [092 217 205] [234 247 134] [255 181 161]<br /> [184 255 184] [184 244 255] [095 217 205] </center></blockquote><p>排在一列</p><blockquote> <center> ０９２<br /> ２１７<br /> ２０５<br /> ２３４<br /> ２４７<br /> １３４<br /> ２５５<br /> １８１<br /> １６１<br /> １８４<br /> ２５５<br /> １８４<br /> １８４<br /> ２４４<br /> ２５５<br /> ０９５<br /> ２１７<br /> ２０５ </center></blockquote><p>二进制即</p><blockquote> <center> ０１０１１１００<br /> １１０１１００１<br /> １１００１１０１<br /> １１１０１０１０<br /> １１１１０１１１<br /> １００００１１０<br /> １１１１１１１１<br /> １０１１０１０１<br /> １０１００００１<br /> １０１１１０００<br /> １１１１１１１１<br /> １０１１１０００<br /> １０１１１０００<br /> １１１１０１００<br /> １１１１１１１１<br /> ０１０１１１１１<br /> １１０１１００１<br /> １１００１１０１ </center></blockquote><p>字符’例’在matlab中的编码（Unicode）是20363，二进制为100,1111,1000,1011，补位18位，即00,0100,1111,1000,1011，用这18个数依次替换上面那18个RGB值的最后一位，得到</p><blockquote> <center> ０１０１１１００<br /> １１０１１０００<br /> １１００１１００<br /> １１１０１０１１<br /> １１１１０１１０<br /> １００００１１１<br /> １１１１１１１１<br /> １０１１０１０１<br /> １０１００００１<br /> １０１１１００１<br /> １１１１１１１１<br /> １０１１１０００<br /> １０１１１０００<br /> １１１１０１００<br /> １１１１１１１１<br /> ０１０１１１１０<br /> １１０１１００１<br /> １１００１１０１ </center></blockquote><p>重新转化成RGB值，得到</p><blockquote> <center> [092 216 204] [235 246 134] [255 181 161]<br /> [185 255 184] [184 244 255] [094 217 205] </center></blockquote><p>对应的图片为</p><p><img src="/assets/pix2.png" /></p><p>变换前后是看不出什么变化的。</p><div class="divider"></div><h2 id="section-2">实现</h2><p>实现和上面方法稍有不同的是，并没有直接替换最后一位，而是如果最后一位本来就是想存的数，则不处理；否则，将这个数减1（如果是0，变为1）。效果和上面的方法是一样的。</p><p>下面是用MATLAB的写的两个函数：</p><p>imageEncrypter，将st的内同存进im中</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="k">function</span> <span class="n">I</span> <span class="o">=</span> <span class="n">imageEncrypter</span><span class="p">(</span><span class="n">st</span><span class="p">,</span> <span class="n">im</span><span class="p">)</span>

<span class="n">array</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">st</span><span class="p">)</span> <span class="mi">0</span><span class="p">];</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">length</span><span class="p">(</span><span class="n">array</span><span class="p">);</span>

<span class="n">im</span> <span class="o">=</span> <span class="nb">double</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
<span class="n">x</span> <span class="o">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="nb">fprintf</span><span class="p">(</span><span class="s1">'This image can save %.0f chars at most.\n'</span><span class="p">,</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">/</span><span class="mi">6</span><span class="p">);</span>
<span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="p">/</span><span class="mi">6</span>
  <span class="nb">fprintf</span><span class="p">(</span><span class="s1">'Sorry, you can</span><span class="se">''</span><span class="s1">t save %.0f chars in this image\n'</span><span class="p">,</span> <span class="n">n</span><span class="p">);</span>
  <span class="n">I</span> <span class="o">=</span> <span class="n">im</span><span class="p">;</span>
  <span class="k">return</span><span class="p">;</span>
<span class="k">end</span>

<span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">x</span>
  <span class="k">for</span> <span class="nb">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">y</span>
    <span class="k">if</span> <span class="nb">bitxor</span><span class="p">(</span><span class="mi">1</span><span class="o">&amp;</span><span class="nb">bitand</span><span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">+</span><span class="mi">2</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">)),</span> <span class="nb">bitand</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
      <span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="nb">bitxor</span><span class="p">(</span><span class="mi">1</span><span class="o">&amp;</span><span class="nb">bitand</span><span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">)),</span> <span class="nb">bitand</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
      <span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="nb">bitxor</span><span class="p">(</span><span class="mi">1</span><span class="o">&amp;</span><span class="nb">bitand</span><span class="p">(</span><span class="mi">2</span><span class="o">^</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="n">p</span><span class="p">),</span> <span class="n">array</span><span class="p">(</span><span class="n">k</span><span class="p">)),</span> <span class="nb">bitand</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
      <span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">);</span>
    <span class="k">end</span>

    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span><span class="o">-</span><span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
      <span class="n">p</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
      <span class="n">k</span> <span class="o">=</span> <span class="n">k</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">n</span>
      <span class="k">break</span><span class="p">;</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="k">if</span> <span class="n">k</span> <span class="o">&gt;</span> <span class="n">n</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">I</span> <span class="o">=</span> <span class="nb">uint8</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>

<span class="k">end</span>
</code></pre></div><p>imageDecrypter，将im中存的信息提取出来</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="k">function</span> <span class="n">st</span> <span class="o">=</span> <span class="n">imageDecrypter</span><span class="p">(</span><span class="n">im</span><span class="p">)</span>

<span class="n">im</span> <span class="o">=</span> <span class="nb">double</span><span class="p">(</span><span class="n">im</span><span class="p">);</span>
<span class="n">x</span> <span class="o">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span> <span class="n">y</span> <span class="o">=</span> <span class="nb">size</span><span class="p">(</span><span class="n">im</span><span class="p">,</span> <span class="mi">2</span><span class="p">);</span>

<span class="n">num</span> <span class="o">=</span> <span class="p">[];</span>

<span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span> <span class="nb">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">x</span>
  <span class="k">for</span> <span class="nb">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">y</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">bitand</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">bitand</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">k</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="nb">bitand</span><span class="p">(</span><span class="n">im</span><span class="p">(</span><span class="nb">i</span><span class="p">,</span> <span class="nb">j</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">p</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">6</span>
      <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="mi">0</span>
	<span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
	<span class="k">break</span><span class="p">;</span>
      <span class="k">end</span>
      <span class="n">p</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      <span class="n">num</span> <span class="o">=</span> <span class="p">[</span><span class="n">num</span> <span class="n">k</span><span class="p">];</span>
      <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">end</span>
  <span class="k">end</span>
  <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span>
    <span class="k">break</span><span class="p">;</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="n">st</span> <span class="o">=</span> <span class="nb">char</span><span class="p">(</span><span class="n">num</span><span class="p">);</span>

<span class="k">end</span>
</code></pre></div><p>另外，为了解决换行的问题，还写了一个函数getStringFromFile，可以读取整个txt</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="k">function</span> <span class="n">st</span> <span class="o">=</span> <span class="n">getStringFromFile</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="n">f</span> <span class="o">=</span> <span class="nb">fopen</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">);</span>

<span class="n">st</span> <span class="o">=</span> <span class="p">[];</span>
<span class="n">s</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>

<span class="k">while</span> <span class="n">s</span> <span class="o">~=</span> <span class="o">-</span><span class="mi">1</span>
  <span class="n">st</span> <span class="o">=</span> <span class="p">[</span><span class="n">st</span> <span class="nb">char</span><span class="p">(</span><span class="mi">13</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span><span class="o">'</span> <span class="n">s</span><span class="p">];</span>
  <span class="n">s</span> <span class="o">=</span> <span class="nb">fgets</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="k">end</span>

<span class="nb">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
<span class="k">end</span>
</code></pre></div><div class="divider"></div><h2 id="section-3">其他</h2><p>这样，以后就可以藏各种文本信息了，就算藏到头像里，也没人能发现(●ˇ∀ˇ●)</p><p>但其实我并没有发现什么可存的(-__-)!</p><p>在开始的时候，我误以为添加过信息的图片看起来会多多少少有些不自然。但没想到，完全看不出来的有木有！！！比如下面这两张图，前者是原图，后者在里面隐藏了整篇千字文，完全看不出区别。</p><h4 id="before">before</h4><p><img src="/assets/zhu.png" /></p><h4 id="after">after</h4><p><img src="/assets/zhux.png" /></p><div class="divider"></div></article><div class="back"> <a href="/">Back</a></div></main></body></html>