<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1" /><title>转椅子——魔兽争霸之月纹传说</title><meta name="twitter:card" content="summary" /><meta name="twitter:site" content="@XueZhonghao" /><meta name="twitter:title" content="转椅子——魔兽争霸之月纹传说" /><meta name="twitter:description" content="背景"><meta name="description" content="背景"><meta name="google-site-verification" content="epFgX0s_0RM3CdjwFcsewfXzPov2g8s9ZBOLyaIUH-o"><link rel="shortcut icon" href="/assets/totora.png"> <!--<link rel="icon" href="/assets/totora.png">--><link rel="apple-touch-icon" href="/assets/touch-icon.png"><link rel="stylesheet" href="//code.cdn.mozilla.net/fonts/fira.css"><link rel="stylesheet" href="/assets/core.css"><link rel="stylesheet" href="/assets/prism.css"><link rel="canonical" href="/notes/moon-legend"><link rel="alternate" type="application/atom+xml" title="AlanXue's blog" href="/feed.xml" /></head><body><aside class="logo"> <a href="/"> <img src="/assets/Totora2.png"> </a> <span class="logo-prompt">Back to Home</span></aside><!--src="http://www.gravatar.com/avatar/742cf6353760888dd24b7f22843cca55.png?s=80" class="gravatar" --><main> <noscript><style> article .footnotes { display: block; }</style></noscript><article><div class="center"><h1>转椅子——魔兽争霸之月纹传说</h1><time>May 2, 2016</time></div><div class="divider"></div><h2 id="section">背景</h2><p>前些天老葛玩魔兽争霸的时候，被一个叫做转椅子的游戏给拦住了去路。但是看见这一关，第一反应，我去，这不活生生一道OI题，作为一个曾经的OIer，我瞬间来了敲代码的欲望。</p><div class="divider"></div><h2 id="section-1">规则</h2><p>如下图，椅子杂乱的摆放着，现在你每次可以选择一个椅子，使其顺（逆）时针转90°，同时其上、下、左、右的椅子（如果存在）也会顺（逆）时针旋转90°。</p><p>现在要求使用如上规则，将所有椅子转回原位（都向上）。</p><p><img src="/assets/moon_lengend1.png" /></p><p>但既然都编程了，就不要之解决这一个特定的问题啦，我将题目修改为：</p><p>在x*y的方格上，每个格子里有一把椅子，方向是杂乱的，规则同上，输出如何将所有椅子转回原位（都向上）</p><div class="divider"></div><h2 id="section-2">寻找</h2><p>对着题目想了许久，并没有什么思路，这种题搜索看起来不靠谱，动态规划？然而这种十字形状的规则实在找不到规律。</p><p>印象中自己曾经做过一道与之类似的题，也是上下左右，于是开始百度……</p><p>首先发现了知乎上的一篇文章：<a href="https://zhuanlan.zhihu.com/p/19820908">《点灯游戏：迟到8年的美丽，用数学绘制的“二维码”！》</a>，这篇文章写的挺有意思，但真正我想要的还得是立面提到的一篇文章（不知道是不是论文）：<a href="http://mathworld.wolfram.com/LightsOutPuzzle.html">“Lights Out Puzzle.” From <em>MathWorld</em></a></p><p>至此，终于找到了这个名叫<strong>Lights Out Puzzle</strong>的游戏</p><div class="divider"></div><h2 id="section-3">解决</h2><p>看这个解决，请先看<a href="http://mathworld.wolfram.com/LightsOutPuzzle.html">“Lights Out Puzzle.” From <em>MathWorld</em></a></p><p>文章中将问题最终表示成在mod 2的前提下求解线性方程组。</p><p>其中灯的状态有两种可能，1代表亮，0代表灭，在应用规则A[i,j]时，格子L[x,y]的状态更新为(L[x,y]+A[i,j][x,y]) mod 2，（最后的线性方程组每个A都写在一行中，L写在一列中）</p><p>现在考虑转椅子，可以将规则（暂时）简化为只允许顺时针旋转，这并不影响解决问题。</p><p>椅子的状态有四种可能，规定0代表上(↑)，1代表右(→)，2代表下(↓)，3代表左(←)，规则A与点灯问题完全一致。于是仿照点灯问题，在应用规则A[i,j]时，格子L[x,y]的状态的状态更新为(L[x,y]+A[i,j][x,y] mod 4。这样就可以得到一个需要在mod 4的前提下求解的线性方程组。</p><p><em>例子</em></p><blockquote> <center> ← ↓ ↑<br /> → ← ↓ </center></blockquote><p>L =</p><blockquote> <center> ｜３２０｜<br /> ｜１３２｜ </center></blockquote><p>六个A分别是</p><blockquote> <center> ｜１１０｜　｜１１１｜　｜０１１｜<br /> ｜１００｜　｜０１０｜　｜００１｜<br /> <br /> ｜１００｜　｜０１０｜　｜００１｜<br /> ｜１１０｜　｜１１１｜　｜０１１｜ </center></blockquote><p>于是得到线性方程组</p><blockquote> <center> ｜１１０１００｜｜x11｜　｜３｜<br /> ｜１１１０１０｜｜x12｜　｜２｜<br /> ｜０１１００１｜｜x13｜＝｜０｜<br /> ｜１００１１０｜｜x21｜　｜１｜<br /> ｜０１０１１１｜｜x22｜　｜３｜<br /> ｜００１０１１｜｜x23｜　｜２｜ </center></blockquote><p>解得X =</p><blockquote> <center> ｜１３１３１０｜' </center></blockquote><p>即，答案为</p><blockquote> <center> ｜１３１｜<br /> ｜３１０｜ </center></blockquote><p>意思是将L0 =</p><blockquote> <center> ↑ ↑ ↑<br /> ↑ ↑ ↑ </center></blockquote><p>这个状态的六个位置分别顺时针旋转90°，270°，90°，270°，90°，0°即可得到L</p><p>游戏中的要求是想反的，从L到L0，只需将顺时针改为逆时针即可。至此，问题就解决了^_^</p><div class="divider"></div><h2 id="section-4">编程</h2><p>最近在学Python的基础知识，就用Python实现了上述过程。</p><p>A矩阵的计算方法是在A[i,j]的点中，如果与(i,j)的<a href="https://en.wikipedia.org/wiki/Taxicab_geometry">曼哈顿距离(Taxicab geometry)</a>小于等于1的点的值为1，否则为0。</p><p>求解线性方程组用的是<a href="https://en.wikipedia.org/wiki/Gaussian_elimination">高斯消元法(<strong>Gaussian elimination</strong>)</a>，但只是理解了思想，所以写的应该是很不标准的(￣▽￣)”</p><p>接下来是源码(Python3.4.3)</p><div class="highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="n">y</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">gcd</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">%</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">lcm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span><span class="o">*</span><span class="n">y</span><span class="o">//</span><span class="n">gcd</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">a</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="k">print</span><span class="p">()</span>

<span class="c">#to create matrix A[x,y]</span>
<span class="k">def</span> <span class="nf">rule</span><span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">1</span> <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="nb">abs</span><span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">j</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">height</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">width</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">gauss</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
                <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">k</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
                    <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
                    <span class="k">break</span>
        <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">lcm</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">m</span> <span class="o">//</span> <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">m</span> <span class="o">//</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
            <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">x</span><span class="p">]</span><span class="o">*</span><span class="n">n</span><span class="o">-</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">x</span><span class="p">]</span><span class="o">*</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span>
        <span class="n">show</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">cal</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">a</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ans</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="o">%</span><span class="mi">4</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
            <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="o">*</span><span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">ans</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="c">#a not standard method to calculate x[i]</span>
<span class="k">def</span> <span class="nf">cal</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">y</span><span class="o">//</span><span class="n">x</span>

<span class="n">x</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'Input the width:'</span><span class="p">))</span>
<span class="n">y</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s">'Input the height:'</span><span class="p">))</span>

<span class="n">a</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="n">a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">))</span>

<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
    <span class="n">st</span> <span class="o">=</span> <span class="nb">input</span><span class="p">((</span><span class="s">'Input the No.</span><span class="si">%</span><span class="s">d line(divided by space):'</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">)))</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">st</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">' '</span><span class="p">):</span>
        <span class="n">a</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">ans</span> <span class="o">=</span> <span class="n">gauss</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="k">if</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ans</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
    <span class="k">print</span><span class="p">(</span><span class="s">'No answer!'</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">'</span><span class="si">%2</span><span class="s">d '</span> <span class="o">%</span> <span class="n">ans</span><span class="p">[</span><span class="n">j</span><span class="o">*</span><span class="n">x</span><span class="o">+</span><span class="n">i</span><span class="p">],</span> <span class="n">end</span><span class="o">=</span><span class="s">''</span><span class="p">)</span>
        <span class="k">print</span><span class="p">()</span>

</code></pre></div><div class="divider"></div><h2 id="section-5">其他</h2><p>通过点灯游戏再一次看到了百度百科和wikipedia的差距，可以自己感受一下（一个上来就暴力求解，另一个上来就跟你侃数学）（不算简介）。</p><p><a href="http://baike.baidu.com/link?url=J-veA0Pgtva_nwhq_A9PIlea62Dykm2PfimDstR_R-FmsRHztgxaXmWsE7-Fl4xvXUBZUkHWbUOVgideYvg6ZK"><strong>点灯游戏</strong>-百度百科</a></p><p><a href="https://en.wikipedia.org/wiki/Lights_Out_%28game%29"><strong>Lights Out(game)</strong> from <em>Wikipedia</em></a></p><div class="divider"></div></article><div class="back"> <a href="/">Back</a></div></main></body></html>